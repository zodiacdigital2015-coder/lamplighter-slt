<% const MAX_PROMPTS_ON_DISPLAY = 15; %>

<!DOCTYPE html>
<html>
<head>
    <title>Institutional Memory | Lamp Lighter</title>
    <link rel="stylesheet" href="/styles.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" />    
    <style>
        /* SLT Specific Styling - Midnight Blue & Gold Theme */
        :root {
            --primary-color: #0f172a; /* Slate 900 - Deep Executive Blue */
            --accent-color: #b45309;  /* Amber 700 - Deep Gold */
        }
        
        body { background-color: #f8fafc; }
        .siteTitle { color: #0f172a !important; }
        
        .slt-badge {
            background-color: #b45309 !important; /* GOLD Badge */
            color: #fff;
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 0.75rem;
            vertical-align: middle;
            margin-left: 10px;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            font-weight: 700;
        }

        .welcome-section h2 { color: #0f172a !important; }
        
        .btn-primary {
            background-color: #0f172a !important;
            border-color: #0f172a !important;
            transition: all 0.2s;
        }
        .btn-primary:hover {
            background-color: #b45309 !important; /* Gold on Hover */
            border-color: #b45309 !important;
        }

        .ingredients-label {
            color: #475569 !important;
            font-weight: 700;
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* External Context Toggle Box (Yellow) */
        .external-context-box {
            background-color: #fffbeb; 
            border: 1px solid #fcd34d;
            border-radius: 6px;
            padding: 12px 15px;
            margin-bottom: 20px;
            display: flex;
            align-items: flex-start;
            gap: 12px;
            height: 100%; /* Ensures equal height if used in grid */
        }
        
        .external-context-box input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
            accent-color: #b45309;
            margin-top: 3px; 
            flex-shrink: 0; 
        }

        .external-context-text { flex: 1; }

        .external-context-text strong {
            color: #92400e;
            display: block;
            margin-bottom: 2px;
            font-size: 0.95rem; 
        }

        .external-context-text p {
            margin: 0;
            font-size: 0.85rem; 
            line-height: 1.4;
            color: #78350f;
        }

        /* Redaction Toggle Box (Secure Blue) */
        .redaction-box {
            background-color: #f1f5f9; /* Slate 100 - Very Light Blue/Grey */
            border: 1px solid #0f172a; /* Slate 900 - Matching the theme */
            border-radius: 6px;
            padding: 12px 15px;
            margin-bottom: 20px;
            display: flex;
            align-items: flex-start; 
            gap: 12px;
            height: 100%;
        }

        .redaction-box input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
            accent-color: #0f172a; /* Dark Blue Checkbox */
            margin-top: 3px; 
            flex-shrink: 0; 
        }

        .redaction-text { flex: 1; }

        .redaction-text strong {
            color: #0f172a;
            display: block;
            margin-bottom: 2px;
            font-size: 0.95rem; 
        }

        .redaction-text p {
            margin: 0;
            font-size: 0.85rem; 
            line-height: 1.4;
            color: #334155;
        }
    </style>
</head>

<body class="home-page">
    <div class="home-container" id="home-container">

        <div class="home-header">
            <div class="header-left">
                <h1 class="siteTitle">Lamp<span style="font-weight:400">Lighter</span> <span class="slt-badge">Leadership</span></h1>
            </div>
            <div class="header-right">
                <span style="font-weight: 600; color: #334155;">Senior Leadership Team</span>
            </div>        
        </div>

        <div class="home-content" id="home-content">

            <div class="choice-container" id="choice-container">
                
                <div class="welcome-section" style="text-align: center; margin-bottom: 30px; padding-bottom: 20px; border-bottom: 1px solid #e2e8f0;">
                    <h2 style="font-size: 2rem; margin-bottom: 10px; font-weight: 700;">Institutional Memory</h2>
                    <p style="color: #64748b; font-size: 1.1rem; max-width: 650px; margin: 0 auto;">
                        Recall strategic context, track historical commitments, and identify recurring risks across the college's secure document corpus.
                    </p>
                </div>

                <div class="row">
                    <div class="col-1"></div>
                    <div class="col-5 dropdown-item">
                        <label for="questionType" class="ingredients-label">Strategic Lens:</label>
                        <select id="questionType" name="questionType" class="styled-input">
                            <option value="" disabled selected>Primary Goal...</option>
                            <option value="strategic-alignment">Strategic Alignment (Mission/Goals)</option>
                            <option value="historical-context">Historical Context (Past Decisions)</option>
                            <option value="risk-patterns">Risk Patterns (Recurring Issues)</option>
                            <option value="commitment-tracking">Commitment Tracking (Agreed Actions)</option>
                            <option value="evidence-impact">Evidence of Impact (Outcomes)</option>
                        </select>  
                    </div>  
                    <div class="col-5 dropdown-item">
                        <label for="stakeholderLens" class="ingredients-label" style="color:#b45309 !important;">Stakeholder Perspective:</label>
                        <select id="stakeholderLens" name="stakeholderLens" class="styled-input">
                            <option value="General" selected>General Overview</option>
                            <option value="Financial">Financial Sustainability & Efficiency</option>
                            <option value="Quality">Quality of Education (Ofsted)</option>
                            <option value="Reputational">Reputation & Stakeholder Trust</option>
                            <option value="Staffing">HR & Organisational Culture</option> <option value="Student">Student Experience & Outcomes</option>
                        </select>  
                    </div>  
                    <div class="col-1"></div>
                </div>

                <div class="row">
                    <div class="col-1"></div>
                    <div class="col-5 dropdown-item">
                        <label for="timeScope" class="ingredients-label">Time Horizon:</label>
                        <select id="timeScope" name="timeScope" class="styled-input">
                            <option value="" disabled selected>Select range...</option>
                            <option value="12-months">Last 12 Months (Current Cycle)</option>
                            <option value="2-years">Last 2 Years</option>
                            <option value="3-years">Last 3 Years (Full Strategic Cycle)</option>
                            <option value="all-records">All Available Records</option>
                        </select>  
                    </div>
                    <div class="col-5 dropdown-item">
                        <label for="docPriority" class="ingredients-label">Document Priority:</label>
                        <select id="docPriority" name="docPriority" class="styled-input">
                            <option value="Balanced" selected>Balanced View (All Sources)</option>
                            <option value="Strategic">Prioritise Strategic Plan (Promises)</option>
                            <option value="Board">Prioritise Board Minutes (Decisions)</option>
                            <option value="Operational">Prioritise SAR/QIP (Reality)</option>
                            <option value="Approved">Approved Records Only (Exclude Drafts)</option>
                        </select>  
                    </div>
                    <div class="col-1"></div>
                </div>

                <div class="row">
                    <div class="col-1"></div>
                    <div class="col-10 dropdown-item">
                        <label for="topic" class="ingredients-label">Topic / Line of Enquiry:</label>
                        <input id="topic" name="topic" class="styled-input" type="text" placeholder="e.g. Apprenticeship achievement rates, Merger risks, Student mental health funding" />
                    </div>
                    <div class="col-1"></div>
                </div>

                <div class="row">
                    <div class="col-1"></div>
                    
                    <div class="col-5 dropdown-item">
                        <label for="outputStyle" class="ingredients-label">Desired Output Format:</label>
                        <select id="outputStyle" name="outputStyle" class="styled-input">
                            <option value="executive-summary">Executive Summary (High-level)</option>
                            <option value="board-paper">Board Paper Narrative (Formal/Detailed)</option>
                            <option value="risk-register">Risk Matrix Format</option>
                            <option value="timeline">Chronological Timeline</option>
                            <option value="gap-analysis">Gap Analysis (Promise vs Reality)</option>
                        </select>  
                    </div>

<div class="col-5 dropdown-item">
                        <label for="persona" class="ingredients-label" style="color:#0f172a !important;">Voice / Tone:</label>
                        <select id="persona" name="persona" class="styled-input">
                            <option value="neutral" selected>Objective / Neutral Analyst</option>
                            <option value="carina">Carina Briggs</option>
                        </select>  
                    </div>

                    <div class="col-1"></div>
                </div>

                <div class="row">
                    <div class="col-1"></div>
                    
                    <div class="col-5">
                        <div class="external-context-box">
                            <input type="checkbox" id="hasExternalDoc" name="hasExternalDoc">
                            <div class="external-context-text">
                                <strong>External Analysis Mode</strong>
                                <p>Generates a cross-reference prompt. <strong>Attach PDF in Copilot.</strong></p>
                            </div>
                        </div>
                    </div>

                    <div class="col-5">
                        <div class="redaction-box">
                            <input type="checkbox" id="strictRedaction" name="strictRedaction">
                            <div class="redaction-text">
                                <strong>Strict Redaction Mode</strong>
                                <p><strong>Confidentiality Lock:</strong> Strip all names, IDs, and salary figures from the output.</p>
                            </div>
                        </div>
                    </div>

                    <div class="col-1"></div>
                </div>

                <div class="row">
                    <div class="col-12 submit-button">
                        <button class="btn btn-primary" id="generate-button">
                            <div class="material-symbols-outlined response-icon">history_edu</div>
                            Retrieve Institutional Memory
                        </button>
                    </div>
                </div>

                <div class="row">
                    <div class="col-1"></div>
                    <div class="col-10">
                        <div class="loader-container hidden" id="recipe-loader">
                            <div class="loader"></div>
                        </div>
                    </div>  
                    <div class="col-1"></div>
                </div>
            
            </div>
            
            <% for (let i = 1; i <= MAX_PROMPTS_ON_DISPLAY; i++) { %>
            <div class="response-container hidden" id="response-container-<%= i %>">
                <div class="response-text-container" id="response-text-container-<%= i %>">
                    <div class="prompt-grid" style="display: block; margin-top: 15px;">
                        <div class="prompt-box copilot-box" style="border: 2px solid #0f172a; border-radius: 8px; padding: 20px; background: #fff; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);">
                            <div style="display:flex; align-items:center; gap:8px; margin-bottom:15px; color:#0f172a; font-weight:bold; border-bottom: 1px solid #e2e8f0; padding-bottom: 10px;">
                                <span class="material-symbols-outlined" style="color: #b45309;">secure</span> 
                                INSTITUTIONAL MEMORY AGENT
                            </div>
                            <div class="response-text" id="copilot-text-<%= i %>" style="font-size: 1rem; color: #334155; white-space: pre-wrap; line-height: 1.6;"></div>
                            <button id="copy-copilot-<%= i %>" class="btn btn-primary btn-mini" style="width:100%; margin-top:20px;">
                                Copy Prompt
                            </button>
                        </div>
                    </div>
                </div> 
            </div>
            <% } %>

            <div id="generate-more-container" class="row hidden" style="padding-top: 20px;">
                <div class="col-4"></div>        
                <div class="col-4 submit-button">
                    <button class="btn btn-primary" id="generate-more-button">
                        <div class="material-symbols-outlined response-icon">edit_note</div>
                        New Enquiry
                    </button>
                </div>        
                <div class="col-4"></div>
            </div>

        </div>

    </div>

    <script src="/toast.js"></script>
    <script src="/homeHelpers.js"></script>
    <script src="/homeGenerators.js"></script>
    <script src="/home.js"></script>
</body>
</html>